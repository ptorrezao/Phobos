@using Phobos.Helpers

@model MessageMailBoxFolderViewModel

@Html.BeginForm("Action", "Message", FormMethod.Post)

@Html.SetPartialHelper("ButtonsForPager", (Func<HelperResult>)(ButtonsForPager))
<div class="box box-primary">
    <div class="box-header with-border">
        <h3 class="box-title">@Model.Name</h3>
        <div class="box-tools pull-right">
            <div class="has-feedback">
                <input type="text" class="form-control input-sm grid-search" placeholder="Search Mail">
                <span class="glyphicon glyphicon-search form-control-feedback"></span>
            </div>
        </div>
    </div>

    <div class="box-body no-padding">
        @(Html
        .Grid(Model.Messages)
        .Named("mailbox")
        .Build(columns =>
        {
            columns.Add(model => model.MessageId)
                    .RenderedAs(model => "<input name='selectedIds' type='checkbox' value='" + model.MessageId.ToString() + "'>")
                    .Encoded(false);
            columns.Add(model => model.IsFavorite)
                    .Encoded(false)
                    .Filterable(false)
                    .RenderedAs(model => Html.FontAwesome("#", model.IsFavorite ? "star" : "star-o", TextColor.Yellow));
            columns.Add(model => model.Sender)
                    .Encoded(false)
                    .Filterable(false)
                    .RenderedAs(model => "<a href=" + Url.Action("ReadMessage", new { id = model.MessageId }) + ">" + model.Sender + "</a>");
            columns.Add(model => model.Title)
                    .Encoded(false)
                    .RenderedAs(model => string.Format("<b>{0}</b> - {1}", model.Title, model.Intro));
            columns.Add(model => model.HasAttachment)
                    .Encoded(false)
                    .Filterable(false)
                    .RenderedAs(model => model.HasAttachment ? Html.FontAwesome("paperclip") : MvcHtmlString.Create(""));
            columns.Add(model => model.Date)
                  .Encoded(false)
                  .Filterable(false)
                  .RenderedAs(model => Html.TimeAgo(model.Date));
        })
        .Filterable(false)
        .Sortable(false)
        .Css("hideTh box-footer no-padding mailbox")
        .Pageable(pager =>
        {
            pager.PagesToDisplay = 0;
            pager.InitialPage = 1;
            pager.RowsPerPage = 16;
        })
        )
    </div>
</div>
@{
    Html.EndForm();
}

@helper ButtonsForPager()
{
    <a class="btn btn-default btn-sm checkbox-toggle masterCheckbox"><i class="fa fa-square-o"></i></a>
    <div class="btn-group">
        <button name="remove" type="submit" class="btn btn-default btn-sm"><i class="fa fa-trash-o"></i></button>
        <button name="reply" type="submit" class="btn btn-default btn-sm"><i class="fa fa-reply"></i></button>
    </div>
}

<script>
    $(document).ready(function () {
        $(".masterCheckbox").click(function () {
            $(".masterCheckbox").children("i").toggleClass("fa-square-o");
            $(".masterCheckbox").children("i").toggleClass("fa-check-square-o");
            $(".masterCheckbox").toggleClass("checked");

            if ($(this).hasClass("checked")) {
                $('.mailbox').find('input[type=checkbox]').prop('checked', true);
            } else {
                $('.mailbox').find('input[type=checkbox]').prop('checked', false);
            }
        });
    });
</script>